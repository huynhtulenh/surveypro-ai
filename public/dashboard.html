<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Qu·∫£n l√Ω kh·∫£o s√°t - SurveyPro AI">
    <title>Dashboard - SurveyPro AI</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <!-- Navigation -->
    <!-- Admin Dashboard: Manage surveys created by this admin -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="/dashboard" class="navbar-brand">SurveyPro AI</a>
            <ul class="navbar-nav">
                <li><a href="/dashboard" class="nav-link">üìã Kh·∫£o s√°t</a></li>
                <li><a href="/admin/dashboard" class="nav-link">üè¢ Qu·∫£n l√Ω</a></li>
            </ul>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="container" style="margin-top: 3rem; margin-bottom: 3rem;">
        <!-- Header -->
        <div class="flex-between mb-4">
            <div>
                <h1>Kh·∫£o s√°t c·ªßa t√¥i</h1>
                <p class="text-secondary">Qu·∫£n l√Ω v√† theo d√µi c√°c kh·∫£o s√°t c·ªßa b·∫°n</p>
            </div>
            <a href="/create-survey" class="btn btn-primary">
                <span style="font-size: 1.25rem; margin-right: 0.5rem;">+</span>
                T·∫°o kh·∫£o s√°t m·ªõi
            </a>
        </div>

        <!-- Surveys Grid -->
        <div id="surveysContainer">
            <div class="flex-center" style="padding: 4rem 0;">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" style="display: none; text-align: center; padding: 4rem 0;">
            <div style="font-size: 5rem; margin-bottom: 1rem;">üìã</div>
            <h3>Ch∆∞a c√≥ kh·∫£o s√°t n√†o</h3>
            <p class="text-secondary mb-3">T·∫°o kh·∫£o s√°t ƒë·∫ßu ti√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu thu th·∫≠p d·ªØ li·ªáu</p>
            <a href="/create-survey" class="btn btn-primary">T·∫°o kh·∫£o s√°t m·ªõi</a>
        </div>
    </div>

    <script src="/js/app.js"></script>
    <script>
        // Protect page - require admin authentication
        requireAdminAuth();
        
        // Update navbar with admin info
        updateAdminNavbar();

        // Load surveys created by this admin
        async function loadSurveys() {
            const container = document.getElementById('surveysContainer');
            const emptyState = document.getElementById('emptyState');

            try {
                const data = await adminApi.get('/surveys');
                const surveys = data.surveys;

                if (surveys.length === 0) {
                    container.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }

                // Render surveys
                container.innerHTML = `
          <div class="grid grid-2">
            ${surveys.map(survey => `
              <div class="card fade-in">
                <div class="card-header">
                  <div class="flex-between">
                    <h3 class="card-title">${survey.title}</h3>
                    <span class="badge badge-${getStatusColor(survey.status)}">
                      ${getStatusText(survey.status)}
                    </span>
                  </div>
                  <p class="text-secondary" style="margin-top: 0.5rem;">
                    ${survey.description || 'Kh√¥ng c√≥ m√¥ t·∫£'}
                  </p>
                </div>
                <div class="card-body">
                  <div style="display: flex; gap: 0.5rem; color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1rem;">
                    <span>üìÖ ${ui.formatDate(survey.createdAt)}</span>
                  </div>
                  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <a href="/analytics/${survey._id}" class="btn btn-sm btn-primary">
                      üìä Xem k·∫øt qu·∫£
                    </a>
                    <button onclick="editSurvey('${survey._id}')" class="btn btn-sm btn-secondary">
                      ‚úèÔ∏è Ch·ªânh s·ª≠a
                    </button>
                    <button onclick="copySurveyLink('${survey._id}')" class="btn btn-sm btn-secondary">
                      üîó Sao ch√©p link
                    </button>
                    <button onclick="deleteSurvey('${survey._id}')" class="btn btn-sm btn-danger">
                      üóëÔ∏è X√≥a
                    </button>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        `;
            } catch (error) {
                container.innerHTML = `
          <div class="alert alert-error">
            L·ªói khi t·∫£i kh·∫£o s√°t: ${error.message}
          </div>
        `;
            }
        }

        function getStatusColor(status) {
            const colors = {
                'draft': 'warning',
                'active': 'success',
                'closed': 'danger'
            };
            return colors[status] || 'primary';
        }

        function getStatusText(status) {
            const texts = {
                'draft': 'Nh√°p',
                'active': 'ƒêang ho·∫°t ƒë·ªông',
                'closed': 'ƒê√£ ƒë√≥ng'
            };
            return texts[status] || status;
        }

        function editSurvey(id) {
            window.location.href = `/create-survey?id=${id}`;
        }

        function copySurveyLink(id) {
            const link = `${window.location.origin}/survey/${id}`;
            navigator.clipboard.writeText(link).then(() => {
                ui.showAlert('ƒê√£ sao ch√©p link kh·∫£o s√°t!', 'success');
            }).catch(() => {
                ui.showAlert('Kh√¥ng th·ªÉ sao ch√©p link', 'error');
            });
        }

        async function deleteSurvey(id) {
            if (!ui.confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh·∫£o s√°t n√†y?')) {
                return;
            }

            try {
                await adminApi.delete(`/surveys/${id}`);
                ui.showAlert('ƒê√£ x√≥a kh·∫£o s√°t th√†nh c√¥ng', 'success');
                loadSurveys();
            } catch (error) {
                ui.showAlert('L·ªói khi x√≥a kh·∫£o s√°t: ' + error.message, 'error');
            }
        }

        // Load surveys on page load
        loadSurveys();
    </script>
</body>

</html>